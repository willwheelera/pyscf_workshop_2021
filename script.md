# New focus: GPU implementation

## Motivation: scaling vs accuracy 

QMC is a valuable method to add to the pyscf ecosystem

## Motivation: profiling

code spends most time evaluating wave function and derivatives



## How it works

eval_gto on CPU
configs on CPU
VMC/DMC run on CPU

wf (Slater, Jastrow) sends data to GPU to evaluate value, gradient, laplacian, and sends result back to CPU
Ewald sends data to GPU and sends result back to CPU

Flowchart of VMC/DMC process and where GPU gets used




=======================================================

# Slide 2 (2): Electronic structure methods
- There are many methods for doing ab initio calculations of molecules and materials
- Choosing a method is usually a tradeoff between accuracy and computational cost
- Different materials and research questions are suited to different methods
- It's important to compare different methods on the same problem
** highly accurate methods should produce the same result
** with multiple methods, we can assess our confidence in the result -- see how well they agree

## Slide 3 (2) animate figure?
- One way to measure computational cost is how the method scales with system size
- This figure shows some data generated by a huge collaboration to benchmark different methods
- The y-axis of this plot is the scaling of the method
- The x-axis is a measure of accuracy, with 0 at the right being most accurate
- Diffusion Monte Carlo gets reasonable accuracy with $N^3$ scaling
** Although the scaling is the same, the prefactor is about 1000 times more expensive than PBE
** For some problems the accuracy is worth the cost, true for most strongly correlated systems
** good deal for intermediate-sized systems


# Slide 4 (new): Diffusion Monte Carlo
- Like the other methods, the goal of DMC is to find the ground state of a many-electron Hamiltonian
- Start with a trial function "guess"
- Project out the ground state by applying the operator e^{-Ht}

- If we expand the trial function in eigenstates of H, we can see the states above the ground state are exponentially suppressed
- Just have to normalize
- There are some approximations:
** Fixed-node approximation: keeps positive and negative contributions of the random walk from drowning out the signal. With the correct nodal surface, we will get the right answer.
** Locality approximation: a way to deal with the sign problem when using nonlocal pseudopotentials
- The approximations get closer, and the DMC converges much faster, when the trial function is more accurate.

# Slide 5 (3): Tyipcal DMC workflow
- We use mean-field or multi-determinant methods to generate the starting functions
** reasonably accurate and cheap starting point
- The wave function form has adjustable parameters. These are chosen to minimize the energy expectation of the trial function before doing DMC
- With DMC we compute energy and other observables

# Slide 6 (5)(change order): QMC methods in two minutes
## Animate columns -- 7, 8
- Our QMC is done in real space
- The wave function maps the $3N$ coordinates of all electrons to a complex scalar 
$\Psi: \mathbb{R}^{3N} \rightarrow \mathbb{C}$
- Slater-Jastrow trial function form
** Antisymmetric part is a Slater determinant constructed from the orbitals of the mean-field calculation, can be multiple determinants
** Symmetric part is an exponential, Jastrow function depends on particle distances
- VMC evaluates expectation values over trial function
** Used to optimize wave function parameters
** Integral performed by random walk in $3N$ dimensional electron coordinate space to sample $|Psi|^2$
- DMC projection performed by random walk
** $e^{-Ht}|Psi\rangle = e^{-HN\tau}|Psi\rangle  \approx \prod_N e^{-V\tau}e^{-T\tau} |\Psi\rangle$ 
** kinetic energy is diffusion process, potential energy gives weights to each walker.
** ground state reached for large enough $t$
** fixed-node approximation requires accurate trial function -> need a reasonably good method to provide the guess

# Slide 9 (3): Challeges of interfacing different codes
- converting between nonstandard file formats
- matching hamiltonian and basis
- multiple steps of reading, processing, and converting files

- These factors slow down development and complicate running the code

# Slide 10 (4): Advantages of the PySCF ecosystem

- One-stop shop for advanced methods: make accurate calculations easier
** can easily compare different methods
** mean-field or multi-determinant inputs for QMC
- PySCF has many electronic structure methods implemented
- Interfaces with highly accurate methods DMRG, SHCI, FCIQMC
- PyQMC brings QMC into this ecosystem -- will be directly integrated soon

# Slide 11 (6): PyQMC benefits
- In the rest of the talk, I will show that PyQMC
** is easy to use
** is easy to develop
** and gives accurate results

# Slide 12 (7): Repeat workflow
- I will show what it looks like to run this workflow in code

# Slide 13 (8): Example: H2O molecule -> change to benzene
- Everyone is probably familiar with running a pyscf calculation
** Basic HF or DFT
- PyQMC recipes take in the mean-field file, and save results to the output file
** to run VMC and DMC using an optimized wave function, need to specify the optimization output file
** other parameters can be provided through keyword arguments
- Results from these runs look reasonable
** optimization reduces energy and levels off
** VMC warmup is short
** DMC energy slightly lower than VMC

# Slide 14 (9): Fast development
- our group developed a new excited state method using VMC
- idea: 
** first excited state is orthogonal to the ground state
** second excited state is orthogonal to first two eigenstates, etc
** add a term to the cost function that penalized overlap with lower states
** -> a flexible parametrization will optimize to correct eigenstates
** because of limited parametrization, we perform DMC on the results, hoping that the nodes were optimized well
- it's a complex algorithm with several parts
- it was written mostly in one month, with tweaks over the following months
- a paper was published one year later

# Slide 15 (10): Accurate results: excited states with QMC
[explain results]

# Slide 16 (11): Preliminary GPU testing
- We have enabled GPU acceleration
- We see GPU speedup on a test of different-sized hydrocarbon molecules
- On periodic systems, we have a hard time getting speedup
** the orbital evaluation happens on CPU and takes the most time




